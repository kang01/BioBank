<?xml version="1.0" encoding="utf-8"?>
<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">
    <!--
        Added the view for entity StockOutApply.
    -->
    <changeSet id="20170521000000-2" author="jhipster">

        <createView viewName="view_frozen_tube_list">
            SELECT
                t.id,(box.equipment_code||'.'||box.area_code||'.'||box.support_rack_code||'.'||box.columns_in_shelf||lpad(box.rows_in_shelf,2,0)) as position,
                (t.tube_rows||lpad(t.tube_columns,2,0)) as position_in_box,
                t.frozen_box_code,t.sample_code,t.project_code,p.project_name ,
                t.sample_type_name as sample_type, sc.sample_classification_name as sample_classification ,
                t.gender as sex,t.age,t.disease_type,t.is_hemolysis,t.is_blood_lipid,t.sample_used_times,
                t.status,box.status as frozen_tube_state,
                box.equipment_code,box.equipment_id,box.area_code,box.area_id,box.support_rack_code as shelves_code ,box.support_rack_id as shelves_id,
                box.columns_in_shelf,box.rows_in_shelf,t.tube_rows,t.tube_columns,
                t.sample_type_id,t.sample_classification_id
            FROM frozen_tube t
            LEFT JOIN frozen_box box ON t.frozen_box_id = box.id
            LEFT JOIN project p ON p.id = t.project_id
            LEFT JOIN sample_type s ON s.id = t.sample_type_id
            LEFT JOIN sample_class sc on  t.sample_classification_id = sc.id
        </createView>

    </changeSet>
</databaseChangeLog>
