<div class="transport-record-new">
    <div>
        <h3 class="pull-left">新增转运记录
            <small>&nbsp;{{vm.transportRecord.transhipCode}}</small>
        </h3>
        <div class="form-group pull-right pr-10">
            <div class="text-right">
                <button type="button" class="btn btn-primary" ng-click="vm.transferFinish()"
                        ng-disabled="!vm.boxLength || !vm.transportRecord.receiver ||
                        !vm.transportRecord.transhipDate || !vm.transportRecord.projectId ||
                        !vm.transportRecord.receiveDate ||
                        !vm.transportRecord.trackNumber"
                        ng-show="vm.transportRecord.transhipState == '1001'">转运完成
                </button>
                <button type="button" class="btn btn-default" ng-click="vm.saveRecord()"
                        ng-disabled="!vm.transportRecord.transhipDate || !vm.transportRecord.projectId"
                        ng-show="vm.transportRecord.transhipState == '1001'">保存转运记录
                </button>
                <button type="button" class="btn btn-default" ng-click="vm.invalid()"
                        ng-show="vm.transportRecord.transhipState == '1001'">作废
                </button>
                <button type="button" class="btn btn-default" ui-sref="transport-record">关闭</button>
            </div>
        </div>
        <div style="clear: both"></div>
    </div>
    <form class="form-horizontal">
        <div class="row">
            <div class="col-md-3">
                <div class="form-group">
                    <label class="col-md-4 control-label text-left">
                        <span class="required-field"></span>
                        转运日期
                    </label>
                    <div class="col-md-8">
                        <div class="input-group">
                            <input type="text" class="form-control" name="startDate"
                                   uib-datepicker-popup="{{dateformat}}" ng-model="vm.transportRecord.transhipDate"
                                   is-open="vm.datePickerOpenStatus.transhipDate"
                                   required/>
                            <span class="input-group-btn">
                        <button type="button" class="btn btn-default" ng-click="vm.openCalendar('transhipDate')"><i
                            class="glyphicon glyphicon-calendar"></i></button>
                        </span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-group ">
                    <label class="col-md-4 control-label text-left">
                        <span class="required-field"></span>
                        项目编码
                    </label>
                    <div class="col-md-8">
                        <selectize options='vm.projectOptions' config="vm.projectConfig"
                                   ng-model="vm.transportRecord.projectId" ng-disabled="vm.boxLength"></selectize>
                        <!--<input type="text" class="form-control"  ng-model="vm.transportRecord.projectSiteCode">-->
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-group three-col project-sites">
                    <label class="col-md-4 control-label text-left">项目点</label>
                    <div class="col-md-8">
                        <selectize options='vm.projectSitesOptions' config="vm.projectSitesConfig"
                                   ng-model="vm.transportRecord.projectSiteId"></selectize>
                        <!--<input type="text" class="form-control"  ng-model="vm.transportRecord.projectCode">-->
                    </div>
                </div>

            </div>
            <div class="col-md-3">
                <div class="form-group ">
                    <label class="col-md-4 control-label text-left">
                        <span class="required-field"></span>
                        运单号
                    </label>
                    <div class="col-md-8">
                        <input type="text" class="form-control" ng-model="vm.transportRecord.trackNumber">
                    </div>
                </div>

            </div>
        </div>
        <div class="row">
            <div class="col-md-3">
                <div class="form-group ">
                    <label class="col-md-4 control-label text-left">转运批次</label>
                    <div class="col-md-8">
                        <input type="number" class="form-control" ng-model="vm.transportRecord.transhipBatch">
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-group ">
                    <label class="col-md-4 control-label text-left">状态</label>
                    <div class="col-md-8">
                        <selectize options='vm.statusOptions' config="vm.statusConfig"
                                   ng-model="vm.transportRecord.transhipState" ng-disabled="true"></selectize>
                        <input type="hidden" name="level" ng-model="vm.transportRecord.transhipState" required>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-group three-col">

                    <label class="col-md-4 control-label text-left">
                        <span class="required-field"></span>
                        接收人</label>
                    <div class="col-md-8">
                        <selectize options='vm.receiverOptions' config="vm.receiverConfig"
                                   ng-model="vm.transportRecord.receiver"></selectize>
                        <input type="hidden" class="form-control" ng-model="vm.transportRecord.receiver">
                    </div>
                </div>

            </div>
            <div class="col-md-3">
                <div class="form-group ">
                    <label class="col-md-4 control-label text-left">
                        <span class="required-field"></span>
                        接收日期
                    </label>
                    <div class="col-md-8">
                        <div class="input-group">
                            <input type="text" class="form-control" name="receiveDate"
                                   uib-datepicker-popup="{{dateformat}}" ng-model="vm.transportRecord.receiveDate"
                                   is-open="vm.datePickerOpenStatus.receiveDate"
                                   required/>
                            <span class="input-group-btn">
                                <button type="button" class="btn btn-default" ng-click="vm.openCalendar('receiveDate')"><i
                                class="glyphicon glyphicon-calendar"></i></button>
                            </span>
                        </div>
                    </div>
                </div>

            </div>

        </div>
        <div class="row">
            <div class="col-md-3">
                <div class="form-group">
                    <label class="col-md-4 control-label text-left">样本人份</label>
                    <div class="col-md-8">
                        <input type="number" class="form-control" ng-model="vm.transportRecord.sampleNumber">
                    </div>
                </div>

            </div>
            <div class="col-md-3">
                <div class="form-group">
                    <label class="col-md-4 control-label text-left">有效样本数</label>
                    <div class="col-md-8">
                        <input type="number" class="form-control" ng-model="vm.transportRecord.effectiveSampleNumber">
                    </div>
                </div>

            </div>
            <div class="col-md-3">
                <div class="form-group three-col">
                    <label class="col-md-4 control-label text-left">冻存盒数</label>
                    <div class="col-md-8">
                        <input type="number" class="form-control" ng-model="vm.transportRecord.frozenBoxNumber">
                    </div>
                </div>

            </div>
            <div class="col-md-3">
                <div class="form-group">
                    <label class="col-md-4 control-label text-left">备注</label>
                    <div class="col-md-8">
                        <input type="text" class="form-control" ng-model="vm.transportRecord.memo">
                    </div>
                </div>

            </div>

        </div>
        <div class="row">
            <div class="col-md-3">
                <div class="form-group ">
                    <label class="col-md-4 control-label text-left">空管数</label>
                    <div class="col-md-8">
                        <input type="number" class="form-control" ng-model="vm.transportRecord.emptyTubeNumber">
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-group ">
                    <label class="col-md-4 control-label text-left">空孔数</label>
                    <div class="col-md-8">
                        <input type="number" class="form-control" ng-model="vm.transportRecord.emptyHoleNumber">
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-group ">
                    <label class="col-md-4 control-label text-left">样本满意度</label>
                    <div class="col-md-8">
                        <!--<selectize options='vm.satisfactionOptions' config="vm.satisfactionConfig"-->
                                   <!--ng-model="vm.transportRecord.sampleSatisfaction"></selectize>-->
                        <!--<input type="hidden" class="form-control" ng-model="vm.transportRecord.sampleSatisfaction">-->
                        <span ng-repeat="rating in vm.ratings">
                            <div star-rating rating-value="rating.current" max="rating.max"
                                on-rating-selected="vm.getSelectedRating(rating)"
                            ></div>
                        </span>
                        <!--<div star rating-value="vm.ratingVal" max="vm.max"-->
                             <!--on-hover="vm.onHover()"-->
                             <!--on-leave="vm.onLeave()"-->
                             <!--readonly="{{vm.readonly}}">-->
                        <!--</div>-->
                        <!--<div>-->
                            <!--Max: <input type="number" name="input" ng-model="vm.max" min="0" max="99" required>-->
                            <!--<p>current value: {{vm.ratingVal}}</p>-->
                            <!--<p>hover on : {{vm.hoverVal ? vm.hoverVal : "none"}}</p>-->
                            <!--<p>readonly : <input type="checkbox"-->
                                                 <!--ng-model="vm.readonly"></p>-->
                        <!--</div>-->

                    </div>
                </div>
            </div>
        </div>

    </form>
    <hr style="margin-top: 12px">
    <div class="row">
        <div class="col-md-2">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <div class="row">
                        <div class="col-md-6 pl-5 pr-0">
                            <h4>转运冻存盒</h4>
                        </div>
                        <div class="col-md-6 pl-0 pr-5 text-right" style="margin-top: 8px !important;">
                            <button type="button" class="btn btn-primary btn-xs" ng-click="vm.importFrozenStorageBox('lg')"
                                    ng-show="vm.transportRecord.transhipState == '1001'">导入冻存盒
                            </button>
                        </div>
                    </div>

                </div>
                <div class="panel-body p-0">
                    <table datatable="" dt-options="vm.dtOptions" dt-columns="vm.dtColumns" dt-instance="vm.dtInstance"
                           class="table table-striped table-bordered"></table>
                </div>
            </div>
        </div>


        <div class="col-md-10 pl-0">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <div class="row">
                        <div class="col-md-2">
                            <h4>转运盒详情</h4>
                        </div>
                        <div class="col-md-4">
                            <ul class="list-inline" style="margin-top: 9px">
                                <li><span>样本数</span>
                                    <span>{{vm.normalCount}}</span></li>
                                <li><span>空管</span>
                                    <span>{{vm.emptyPipeCount}}</span>
                                </li>
                                <li><span>空孔</span>
                                    <span>{{vm.emptyHoleCount}}</span>
                                </li>
                                <li><span>异常</span>
                                    <span>{{vm.abnormalCount}}</span></li>
                                <li></li>
                            </ul>
                        </div>
                        <div class="col-md-6 text-right mt-10 " ng-show="vm.transportRecord.transhipState == '1001'">
                            <button type="button" class="btn btn-default btn-xs btn-primary" ng-click="vm.saveBox()" ng-disabled="!vm.box">
                                保　　存
                            </button>
                            <button type="button" class="btn btn-default btn-xs btn-danger" ng-click="vm.delBox()" ng-disabled="!vm.box">
                                删除盒子
                            </button>
                            <button type="button" class="btn btn-default btn-xs"
                                    ng-class="{true:'btn-primary',false:''}[vm.flagStatus]" ng-model="vm.flagStatus"
                                    uib-btn-checkbox ng-click="vm.editStatus()" ng-disabled="!vm.box">状态编辑
                            </button>
                            <button type="button" class="btn btn-default btn-xs" ng-click="vm.exchange()"
                                    ng-disabled="!vm.box || vm.flagStatus">样本换位
                            </button>
                            <button type="button" class="btn btn-default btn-xs" ng-click="vm.tubeRemark()"
                                    ng-disabled="!vm.box || vm.flagStatus">样本批注
                            </button>
                            <button type="button" class="btn btn-default btn-xs" ng-click="vm.reImportFrozenBoxData()"
                                    ng-disabled="!vm.box">重新导入
                            </button>
                        </div>
                    </div>


                </div>
                <div class="panel-body p-0">

                    <div class="row">
                        <div class="col-md-3 pr-0 pl-20">
                            <div class="row">
                                <div class="form-group col-md-6">
                                    <label><span class="required-field"></span>冻存盒号</label>
                                    <input type="text" class="form-control" ng-model="vm.box.frozenBoxCode" disabled required
                                           style="min-width:130px;">
                                </div>
                                <div class="form-group col-md-6">
                                    <label><span class="required-field"></span>盒类型</label>
                                    <selectize options='vm.frozenBoxTypeOptions' config="vm.boxTypeConfig"
                                               ng-model="vm.box.frozenBoxTypeId" ng-disabled="!vm.box"></selectize>
                                </div>
                            </div>
                            <div class="row">
                                <div class="form-group col-md-6">
                                    <label><span class="required-field"></span>样本类型</label>
                                    <selectize options='vm.sampleTypeOptions' config="vm.sampleTypeConfig"
                                               ng-model="vm.box.sampleTypeId" ng-disabled="!vm.box"></selectize>
                                    <label class="checkbox-inline pb-10">
                                        <input type="checkbox" ng-model="vm.box.isSplit" ng-disabled="!vm.box || vm.isMixedFlag"
                                               ng-true-value="1" ng-false-value="0">是否分装
                                    </label>
                                </div>
                                <div class="form-group col-md-6">
                                    <label><span class="required-field"></span>样本分类</label>
                                    <selectize options='vm.projectSampleTypeOptions' config="vm.projectSampleTypeConfig"
                                               ng-model="vm.box.sampleClassificationId"
                                               ng-disabled="!vm.box || vm.sampleClassFlag"></selectize>
                                </div>

                            </div>
                            <div class="row">
                                <div class="form-group col-md-12">
                                    <label class="control-label">
                                        <span class="required-field"></span>
                                        存储位置
                                    </label>
                                    <div class="">
                                        <div class="col-md-3 p-0">
                                            <selectize options='vm.frozenBoxPlaceOptions' config="vm.frozenBoxPlaceConfig"

                                                       ng-model="vm.box.equipmentId" ng-disabled="!vm.box"></selectize>
                                            <input type="hidden" ng-model="vm.box.equipmentId" required>
                                        </div>
                                        <div class="col-md-3 p-0 pl-10">
                                            <selectize options='vm.frozenBoxAreaOptions' config="vm.frozenBoxAreaConfig"

                                                       ng-model="vm.box.areaId" ng-disabled="!vm.box"></selectize>
                                            <input type="hidden" ng-model="vm.box.areaId" required>
                                        </div>
                                        <div class="col-md-3 p-0 pl-10">
                                            <selectize options='vm.frozenBoxShelfOptions' config="vm.frozenBoxShelfConfig"

                                                       ng-model="vm.box.supportRackId" ng-disabled="!vm.box"></selectize>
                                        </div>
                                        <div class="col-md-3 p-0 pl-10">
                                            <input type="text" class="form-control" maxlength="3" ng-model="vm.boxRowCol"
                                                   ng-blur="vm.splitPlace()" ng-disabled="!vm.box" >
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <label>备注</label>
                                    <textarea name="memo" class="form-control" rows="10" style="resize: none;ime-mode:disabled"
                                              ng-model="vm.box.memo" ng-disabled="!vm.box" onfocus=" this.style.imeMode='disabled' "></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-9 pipe-table">
                            <div>
                                <span class="">图例说明：</span><span><img src="content/images/legend-for-tube-status.svg"
                                                                      height="30px"/></span>
                            </div>
                            <hot-table hot-id="my-handsontable" settings="vm.settings" class="tube"
                                       style="width: 100%; padding: 0;margin: 0;"></hot-table>
                        </div>
                        <!--<div class="col-md-1" ng-show="vm.transportRecord.transhipState == '1001'">-->
                            <!--<div class="text-right" style="margin-top: 2px">-->

                            <!--</div>-->
                            <!--<div class="text-right" style="margin-top: 2px">-->
                                <!--<button type="button" class="btn btn-default btn-sm" ng-click="vm.delBox()" ng-disabled="!vm.box">-->
                                    <!--删除盒子-->
                                <!--</button>-->
                            <!--</div>-->
                            <!--<div class="text-right">-->
                                <!--<button type="button" class="btn btn-default btn-sm"-->
                                        <!--ng-class="{true:'btn-primary',false:''}[vm.flagStatus]" ng-model="vm.flagStatus"-->
                                        <!--uib-btn-checkbox ng-click="vm.editStatus()" ng-disabled="!vm.box">状态编辑-->
                                <!--</button>-->
                            <!--</div>-->
                            <!--<div class="text-right" style="margin-top: 2px">-->
                                <!--<button type="button" class="btn btn-default btn-sm" ng-click="vm.exchange()"-->
                                        <!--ng-disabled="!vm.box || vm.flagStatus">样本换位-->
                                <!--</button>-->
                            <!--</div>-->
                            <!--<div class="text-right" style="margin-top: 2px">-->
                                <!--<button type="button" class="btn btn-default btn-sm" ng-click="vm.tubeRemark()"-->
                                        <!--ng-disabled="!vm.box || vm.flagStatus">样本批注-->
                                <!--</button>-->
                            <!--</div>-->

                            <!--<div class="text-right" style="margin-top: 2px">-->
                                <!--<button type="button" class="btn btn-default btn-sm" ng-click="vm.reImportFrozenBoxData()"-->
                                        <!--ng-disabled="!vm.box">重新导入-->
                                <!--</button>-->
                            <!--</div>-->

                        <!--</div>-->

                    </div>
                </div>
            </div>

        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <div class="panel panel-default">
               <div class="panel-heading">
                   <div class="row">
                       <div class="col-md-4">
                           <h4>附件</h4>
                       </div>
                       <div class="col-md-8 text-right" style="margin-top: 8px !important;">
                           <button class="btn btn-default btn-xs" ng-click="vm.uploadFile(1)">上传附件</button>
                           <!--<input type="file" id="one-input" accept="image/*" file-model="vm.images"-->
                                  <!--onchange="angular.element(this).scope().vm.img_upload(this.files)"/>-->

                           <!--<div class="button" ngf-select ng-model="vm.file" name="file" ngf-pattern="'image/*'"-->
                                <!--ngf-accept="'image/*'" ngf-max-size="2MB" ngf-min-height="100"-->
                                <!--ngf-resize="{width: 100, height: 100}" ng-click="angular.element(this).scope().vm.img_upload(this.files)">Select</div>-->

                       </div>
                   </div>

               </div>
                <div class="panel-body" >
                    <!--<img ng-src="{{vm.thumb.imgSrc}}" id="transportImage">-->
                    <div  viewer
                          images-data="vm.transportRecordUploadInfo"
                          upload-file = "vm.uploadFile(status,imgData)"
                          del-file = "vm.delUploadInfo(id)"
                    ></div>

                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/ng-template" id="boxModal.html">
    <div class="modal-header">
        <h3 class="modal-title">切换冻存盒</h3>
    </div>
    <div class="modal-body">
        是否保存本次对冻存盒的修改？
    </div>
    <div class="modal-footer">
        <button class="btn btn-primary" type="button" ng-click="ctrl.ok()">保存</button>
        <button class="btn btn-primary" type="button" ng-click="ctrl.unSave()">不保存</button>
        <button class="btn btn-warning" type="button" ng-click="ctrl.cancel()">取消</button>
    </div>
</script>
<script type="text/ng-template" id="reImportDataModal.html">
    <div class="modal-header">
        <h3 class="modal-title">导入冻存盒</h3>
    </div>
    <div class="modal-body">
        确定重新导入冻存盒数据？
    </div>
    <div class="modal-footer">
        <button class="btn btn-primary" type="button" ng-click="ctrl.ok()">确定</button>
        <button class="btn btn-warning" type="button" ng-click="ctrl.cancel()">取消</button>
    </div>
</script>
<script type="text/ng-template" id="removeImgModal.html">
    <div class="modal-header">
        <h3 class="modal-title">删除附件</h3>
    </div>
    <div class="modal-body">
        确定删除附件？
    </div>
    <div class="modal-footer">
        <button class="btn btn-primary" type="button" ng-click="ctrl.ok()">确定</button>
        <button class="btn btn-warning" type="button" ng-click="ctrl.cancel()">取消</button>
    </div>
</script>

